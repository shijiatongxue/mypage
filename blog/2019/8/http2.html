<!DOCTYPE html>
<html lang="ch">
  <head>
    <link rel="icon" href="https://shijiatongxue.github.io/images/sj.png" type="image/png">
    <link rel="shortcut icon" href="https://shijiatongxue.github.io/images/sj.png" type="image/png">
    <link rel="stylesheet" href="https://shijiatongxue.github.io/styles/article.css">
    <title>HTTP2.0</title>
  </head>
  <body>
    <!-- 输入文章类别：网络 -->
    <article>
      <h1>HTTP2.0</h1>
      <p class="info">作者：石嘉</p>
      <p class="info">日期：2019年8月3日</p>
      <p class="info">参考：<a href="https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn">HTTP2简介</a></p>
      <p class="info">参考：<a href="https://http2.akamai.com/demo">官方演示</a></p>
      <p class="info">参考：<a href="https://www.zhihu.com/question/34074946">HTTP/2.0 相比1.0有哪些重大改进？</a></p>
      <h2>简介</h2>
      <p>HTTP2可以让我们的应用更快、更简单、更稳定。</p>
      <p>HTTP2的主要目标是通过该支持完整的请求和响应复用来减少延迟，通过有效压缩HTTP头部字段将协议开销降到最低，同时增加对请求优先级和服务器推送的支持。</p>
      <p>HTTP2没有改动HTTP的应用语义。HTTP方法、状态码、URI和头字段等核心概念和往常一样。不过HTTP2修改了数据格式化（分帧）以及在客户端与服务器间传输的方式。这两点统帅全局，通过新的分帧层向我们应用隐藏了所有复杂性。因此，所有现有的应用都可以不必修改而在新协议下运行。</p>
      <p>为什么不是HTTP1.2？</p>
      <p>为了实现HTTP工作组设定的性能目标，HTTP2引入了一个新的二进制分帧层，该层无法与之前的HTTP1.x服务器和客户端向后兼容，因此协议的主版本提升到HTTP2。</p>
      <h2>HTTP1.x的缺点</h2>
      <ul>
        <li>客户端需要使用多个连接才能实现并发和缩短延迟；</li>
        <li>不会压缩请求和影响头部，从而导致不必要的网络流量；</li>
        <li>不支持有效的资源优先级，导致底层TCP连接的利用率低下；</li>
    </ul>
      <h2>二进制分帧</h2>
      <p>HTTP2所有性能增强的核心在于新的二进制分帧层，它定义了如何封装HTTP。</p>
      <img src="../../../images/binary_framing_layer01.svg" alt="二进制分帧层示意图">
      <h2>数据流、消息流和帧</h2>
      <ul>
        <li>数据流：已建立的连接内的双向字节流，可以承载一条或多条消息。</li>
        <li>消息：与逻辑请求或相应消息对应的完整的一系列帧。</li>
        <li>帧：HTTP2通信的最小单位，每个帧都包含帧头，至少也会标识出当前帧所属的数据流。</li>
      </ul>
        这些概念的关系总结如下：
        <ul>
          <li>所有通信都在一个TCP连接上完成，此连接可以承载任意数量的双向数据流。</li>
          <li>每个数据流都有一个唯一的标识符和可选的优先级信息，用于承载双向消息。</li>
          <li>每条消息都是一条逻辑HTTP消息（例如请求或响应），包含一个或多个帧。</li>
          <li>帧是最小的通信单位，承载着特定类型的数据，例如HTTP头、消息负载等。来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装。</li>
        </ul>
      </ul>
      <img src="../../../images/streams_messages_frames01.svg" alt="数据流和帧">
      <h2>多路复用</h2>
      <img src="../../../images/multiplexing01.svg" alt="HTTP2多路复用">
      <p>上面是快照捕捉的同一个连接内并行的多个数据流。客户端正想服务器传输一个DATA帧，与此同时，服务器正想客户端交错发送数据流1和数据流3的一系列帧。因此，一个连接上同时有3个并行数据流。</p>
      <p>将HTTP消息分解为独立的帧，交错发送，然后在另一端重新组装时HTTP2最重要的一项增强。</p>
      <h2>数据优先级</h2>
      <img src="../../../images/stream_prioritization01.svg" alt="">
      <p>数据流的依赖关系通过将另一个数据流的唯一标识符作为父项引用进行声明；如果忽略标识符，响应数据流将依赖于“根数据流”。声明数据流依赖指出，应尽可能先向父数据流分配资源，然后再向器依赖项分配资源。共享相同父项的数据流，应按其权重比例分配资源。</p>
      <h2>服务端推送</h2>
      <img src="../../../images/push01.svg" alt="服务器推送">
      <p>服务器已经知道客户端下一步要请求什么资源，这时候服务器推送就可以派上用场。</p>
      <p>推送资源可以进行以下处理：</p>
      <ul>
        <li>由客户端缓存</li>
        <li>在不同页面之间重用</li>
        <li>与其他资源一起复用</li>
        <li>由服务器设定优先级</li>
        <li>被客户端拒绝</li>
      </ul>
      <h2>首部压缩</h2>
      <p>在HTTP1.x中，此元数据始终以纯文本形式，通常会给每个传输增加500-800字节的开销。如果使用Cookie，增加的开销有时会达到上千字节。为了减少此开销和提升性能，HTTP2使用HPACK压缩格式压缩请求和响应头元数据，这种格式采用两种简单但是强大的技术：</p>
      <ul>
        <li>支持通过静态哈夫曼树对传输的头部进行编码；</li>
        <li>要求客户端和服务器同时维护和更新一个包含之前见过的头部字段的索引列表。</li>
      </ul>
      <img src="../../../images/header_compression01.svg" alt="HTTP2首部压缩">
      <p>（完）</p>
    </article>
    <script src="https://shijiatongxue.github.io/js/prism.js"></script>
  </body>
</html>